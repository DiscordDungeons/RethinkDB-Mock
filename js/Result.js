// Generated by CoffeeScript 1.12.4
var define, setKind, setType, utils;

setKind = require("setKind");

setType = require("setType");

utils = require("./utils");

define = Object.defineProperty;

module.exports = function(Query) {
  var Result, evalQuery, methods;
  Result = function(parent) {
    var self;
    self = function(key) {
      return self.bracket(key);
    };
    if (utils.isQuery(parent)) {
      self._db = parent._db;
      self._parent = parent;
    } else {
      self._db = null;
      self._parent = Query._expr(parent);
    }
    return setType(self, Result);
  };
  setKind(Result, Query);
  methods = {};
  methods._eval = evalQuery = function(ctx) {
    var result;
    result = this._parent._run();
    this._eval = function(ctx) {
      ctx.type = "DATUM";
      return result;
    };
    ctx.type = "DATUM";
    return result;
  };
  methods._reset = function() {
    delete this._eval;
  };
  Object.keys(methods).forEach(function(key) {
    return define(Result.prototype, key, {
      value: methods[key],
      writable: true
    });
  });
  return Result;
};
